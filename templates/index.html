<!DOCTYPE html>
<html>
    <head>
        <title>Toy Robot V2-4</title>
        <style>
            .inline-block-child {display: inline-block;}
            
            .box {
                  width: 300px;
                    border: 5px black;
                    padding: 50px;
                    margin: 20px;
            }            
        </style>        
        
    </head>
    <body>

        <div id="cli_box" class="inline-block-child box">
            <p id="cli_response" style="font-weight:bold" ></p><br><br>

            <p>Key command here:</p>
            <input id="cli" type="text" class="inline-block-child" style="width: 100px;" placeholder="Input commands here. Enter to send command.">
            <button id="myBtn" class="inline-block-child" onclick="send_cli()">Send</button>
            <script>
                async function send_cli(){
                    let commands = document.querySelector("#cli").value;
                    document.getElementById("cli_response").innerHTML="Sending ...";
                    let session_id = "{{ session_id }}";
                    let api_key = "{{api_key}}"
                    await fetch("https://cli-dot-toy-robot-308706.ue.r.appspot.com/api/cli/" + api_key + "/" + session_id + "%20" + encodeURIComponent(commands), {method:"GET", mode:"cors"})
                    .then(response => {
                        response.json().then(data => {                   
                        document.getElementById("cli_response").innerHTML=data.message;
                        document.querySelector("#cli").value = "";
                        });
                    });
                }

                var input = document.getElementById("cli");
                input.addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("myBtn").click();
                }
                });
            </script>
        </div>

        <div id="file_upload_box" class="inline-block-child box">
            <p id="file_upload_response" style="font-weight:bold" ></p><br><br>
        
            <input id="file_upload" class="inline-block-child" type="file"> 
            <button id="upload" class="inline-block-child" onclick="file_upload()">Send</button>
            <p id=upload_status style="font-style: italic;"></p>
            
            <script>
                document.getElementById("file_upload").addEventListener("change", function(){
                    document.getElementById("upload_status").innerHTML="Reading file ...";
                    var reader=new FileReader();
                    reader.onload = function(){
                        // console.log(reader.result);
                        package = reader.result;    //global variable
                    }

                    reader.readAsText(this.files[0]);

                    document.getElementById("upload_status").innerHTML="File reading complete. Send to run simulation.";
                })

                async function file_upload(data = package) {
                    // console.log(data);
                    // console.log(JSON.stringify(data))
                    let api_key = "{{api_key}}"
                    const response = await fetch("https://toy-robot-308706.ue.r.appspot.com/api/file_upload/" + api_key + "/", {
                        method: 'POST',
                        mode: 'cors',
                        cache: 'no-cache',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                    
                    response.json() // response from api
                    .then(data => {
                        // console.log(data);
                        document.getElementById("file_upload_response").innerHTML=data;
                    });
                    }
            </script>
        </div>
        


    </body>
</html>