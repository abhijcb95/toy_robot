<!DOCTYPE html>
<html>
    <head>
        <title>Toy Robot V2.1</title>

        
    </head>
    <body>
        <p id="response">response</p><br><br>

        <input id="cli" type="text" name = "command line" placeholder="Input commands here. Enter to send command.">
        <button id="myBtn" onclick="send_cli()">Send</button>
        <script>
            async function send_cli(){
                let commands = document.querySelector("#cli").value;
                let session_id = "{{ session_id }}";
                await fetch("https://cli-dot-toy-robot-308706.ue.r.appspot.com/api/cli/" + session_id + "%20" + encodeURIComponent(commands), {method:"GET", mode:"cors"})
                .then(response => {
                    response.json().then(data => {                   
                    document.getElementById("response").innerHTML=data.message;
                    });
                });
            }

            var input = document.getElementById("cli");
            input.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
            event.preventDefault();
            document.getElementById("myBtn").click();
            }
            });
        </script>
        
        <br><br>
      
        <input id="file_upload" type="file"> <p id=upload_status></p>
        <button id="upload" onclick="file_upload()">Send</button>
        
        <script>
            document.getElementById("file_upload").addEventListener("change", function(){
                document.getElementById("upload_status").innerHTML="Reading file ...";
                var reader=new FileReader();
                reader.onload = function(){
                    console.log(reader.result);
                    package = reader.result;    //global variable
                }

                reader.readAsText(this.files[0]);

                document.getElementById("upload_status").innerHTML="File reading complete. Send commands to execute.";
            })

            async function file_upload(data = package) {
                console.log(data);
                console.log(JSON.stringify(data))
                const response = await fetch("https://toy-robot-308706.ue.r.appspot.com/api/file_upload/", {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                response.json() // response from api
                .then(data => {
                    // do something with data
                    console.log(data);
                });
                }
        </script>

    </body>
</html>